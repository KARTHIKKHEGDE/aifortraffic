# Bangalore RL Traffic Control - Environment Configuration
# This file defines all environment parameters for the simulation

# =============================================================================
# SIMULATION SETTINGS
# =============================================================================
simulation:
  # Simulation step length in seconds
  step_length: 1.0

  # Episode duration in simulation seconds
  episode_duration: 3600 # 1 hour

  # Maximum steps per episode
  max_steps: 3600

  # Random seed for reproducibility
  seed: 42

  # Whether to use SUMO GUI
  gui: false

  # Simulation delay (for visualization)
  delay: 0 # milliseconds

# =============================================================================
# JUNCTION CONFIGURATION
# =============================================================================
junctions:
  # Primary junctions to control
  controlled:
    - id: "silk_board"
      name: "Silk Board Junction"
      gps: [12.9173, 77.6221]
      type: "6-way"
      priority: 1 # Highest priority for optimization
      lanes_per_approach: 4
      phases: 4

    - id: "tin_factory"
      name: "Tin Factory Junction"
      gps: [12.9716, 77.6412]
      type: "4-way"
      priority: 2
      lanes_per_approach: 3
      phases: 4

    - id: "hebbal"
      name: "Hebbal Flyover Junction"
      gps: [13.0358, 77.5972]
      type: "4-way-flyover"
      priority: 2
      lanes_per_approach: 5
      phases: 4

    - id: "marathahalli"
      name: "Marathahalli ORR Junction"
      gps: [12.9591, 77.7011]
      type: "4-way"
      priority: 2
      lanes_per_approach: 4
      phases: 4

# =============================================================================
# STATE SPACE CONFIGURATION
# =============================================================================
state_space:
  # State components per junction
  components:
    queue_length: true # Vehicles waiting at red
    density: true # Vehicles per meter
    speed: true # Average speed per lane
    current_phase: true # Current signal phase
    phase_duration: true # Time in current phase
    emergency: true # Emergency vehicle presence
    emergency_lane: true # Lane with emergency vehicle
    weather: true # Weather condition
    downstream: true # Downstream congestion

  # Number of lanes to consider per junction
  lanes_per_junction: 4

  # State normalization
  normalize: true
  queue_max: 50
  density_max: 0.5 # vehicles per meter
  speed_max: 20.0 # m/s

# =============================================================================
# ACTION SPACE CONFIGURATION
# =============================================================================
action_space:
  # Discrete actions
  actions:
    0: "keep_phase" # Maintain current phase
    1: "ns_green" # North-South green
    2: "ew_green" # East-West green
    3: "emergency" # Emergency override

  # Action constraints
  constraints:
    min_green_time: 30 # seconds (normal weather)
    min_green_rain: 45 # seconds (rain weather)
    yellow_duration: 3 # seconds
    all_red_duration: 2 # seconds

# =============================================================================
# REWARD FUNCTION CONFIGURATION
# =============================================================================
reward:
  # Reward weights (must sum consideration for balance)
  weights:
    waiting_time: 0.35 # Penalty for waiting
    queue_length: 0.25 # Penalty for queue
    throughput: 0.15 # Bonus for throughput
    stops: 0.10 # Penalty for stops
    fuel: 0.05 # Penalty for fuel/CO2
    emergency: 0.10 # Bonus for emergency handling

  # Emergency handling
  emergency:
    clearance_bonus: 100.0
    delay_penalty: 50.0

  # Weather adjustments
  weather:
    rain_penalty_multiplier: 1.3
    switching_penalty_rain: 10.0

  # Safety penalties
  safety:
    unsafe_switch_penalty: 20.0
    phase_violation_penalty: 50.0

# =============================================================================
# QUEUE CONFIGURATION SYSTEM
# =============================================================================
queue:
  # Queue mode: 'baseline', 'realistic_bangalore', 'calibrated'
  mode: "realistic_bangalore"

  modes:
    baseline:
      description: "Standard SUMO defaults for initial testing"
      peak_factor: 1.0
      max_queue: 30
      vehicle_period: 3.0 # seconds between vehicles

    realistic_bangalore:
      description: "Scaled to Bangalore traffic patterns"
      peak_factor: 2.5
      max_queue: 100
      vehicle_period: 1.2

    calibrated:
      description: "Future calibration from real sensor data"
      peak_factor: "data_driven"
      max_queue: "sensor_input"
      vehicle_period: "measured"

# =============================================================================
# TRAFFIC SCENARIOS
# =============================================================================
scenarios:
  morning_peak:
    start_hour: 8
    end_hour: 10
    demand_multiplier: 2.5
    description: "Morning rush hour"

  evening_peak:
    start_hour: 18
    end_hour: 20
    demand_multiplier: 2.8
    description: "Evening rush hour"

  off_peak:
    start_hour: 10
    end_hour: 16
    demand_multiplier: 0.8
    description: "Off-peak hours"

  night:
    start_hour: 22
    end_hour: 6
    demand_multiplier: 0.3
    description: "Night hours"

# =============================================================================
# VEHICLE TYPES
# =============================================================================
vehicles:
  types:
    car:
      probability: 0.60
      length: 4.5
      max_speed: 16.67 # 60 km/h
      accel: 2.0
      decel: 4.5

    bus:
      probability: 0.10
      length: 12.0
      max_speed: 13.89 # 50 km/h
      accel: 1.2
      decel: 3.5

    bike:
      probability: 0.20
      length: 2.0
      max_speed: 11.11 # 40 km/h
      accel: 2.5
      decel: 5.0

    auto_rickshaw:
      probability: 0.10
      length: 3.0
      max_speed: 13.89 # 50 km/h
      accel: 1.8
      decel: 4.0

    ambulance:
      probability: 0.0 # Injected separately
      length: 6.0
      max_speed: 25.0 # 90 km/h
      accel: 2.8
      decel: 4.5
      emergency: true
